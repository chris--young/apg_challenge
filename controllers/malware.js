/**
 * /controllers/malware.js
 *
 * @decription: Malware controller layer
 * @author: Chris Young (young.c.5690@gmail.com)
 * @created: September 17th 2015
 */

let malware = require(`${__dirname}/../services/malware.js`);

/**
 * Malware.create()
 * @description: Validates request body and then creates a new malware entry in the database
 * @param: {Object} request
 * @param: {Object} response
 */
exports.create = (request, response) => {
  let requiredAttributes = ['md5', 'classificationName', 'classificationType', 'fileSize', 'fileType'],
      missingAttributes = [],
      invalidAttributes = [];

  requiredAttributes.forEach((key) => {
    if (!request.body[key])
      missingAttributes.push(key);

    if ((request.body[key] + '').length > 64)
      invalidAttributes.push(key);
  });

  if (missingAttributes.length)
    return response.status(400).send(`Missing: ${missingAttributes.join(',')}`);

  if (invalidAttributes.length)
    return response.status(400).send(`Invalid: ${invalidAttributes.join(',')}`);
  
  malware.create(request.body, (error, data) => {
    if (error)
      return response.status(error).send(data);

    response.status(200).send(data);
  });
};

/**
 * Malware.read()
 * @description: Fetches all malware entries from the database
 * @param: {Object} request
 * @param: {Object} response
 */
exports.read = (request, response) => {
  malware.read((error, data) => {
    if (error)
      return response.status(error).send(data);

    response.status(200).send(data);
  });
};

